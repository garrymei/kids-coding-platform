# 安全基线策略文档

## 概述

本文档定义了儿童编程平台的安全基线策略，确保学生数据的安全性和隐私保护，同时满足合规性要求。

## 核心原则

### 1. 默认私有原则

- **学生数据默认不可见**: 所有学生数据默认仅学生本人可见
- **显式授权**: 家长、教师必须通过"学生侧同意"或"班级/课堂邀请"建立关系
- **最小化暴露**: 默认不暴露任何个人信息，包括昵称、学校、班级等

### 2. 授权到期机制

- **家长权限**: 默认90天到期，可续期
- **教师权限**: 默认365天到期，可续期
- **最大期限**: 最长不超过365天
- **到期提醒**: 到期前7天发送提醒通知
- **自动失效**: 到期后自动撤销所有相关权限

### 3. 撤销机制

- **学生主导**: 学生可以随时撤销任何访问权限
- **即时生效**: 撤销操作立即生效，无需等待
- **完全撤销**: 撤销后立即停止所有数据访问
- **通知机制**: 撤销后通知相关方

### 4. 审计机制

- **全链路审计**: 每次查看均产生日志
- **详细记录**: 记录谁在何时查看了什么数据
- **不可篡改**: 审计日志不可修改或删除
- **定期审查**: 定期审查审计日志，发现异常行为

### 5. 搜索策略

- **默认不可搜索**: 学生默认不可被搜索
- **双轨机制**: 安全默认 + 可选开放
- **匿名化处理**: 搜索结果不显示精确个人信息
- **限流保护**: 搜索请求限流，防止滥用

## 详细策略

### 默认私有策略

#### 学生数据保护

- 学习进度、完成情况、作品等数据默认仅学生可见
- 家长、教师无法直接访问学生数据
- 必须通过明确的授权流程建立关系

#### 个人信息保护

- 昵称、学校、班级等信息默认不公开
- 头像、联系方式等敏感信息默认隐藏
- 匿名ID机制保护学生身份

### 授权到期策略

#### 到期时间设置

```yaml
家长权限:
  默认期限: 90天
  最大期限: 365天
  提醒时间: 到期前7天

教师权限:
  默认期限: 365天
  最大期限: 365天
  提醒时间: 到期前7天
```

#### 到期处理流程

1. **到期前提醒**: 发送邮件/站内信提醒
2. **到期检查**: 定时任务检查到期权限
3. **自动撤销**: 到期后自动撤销权限
4. **通知相关方**: 通知学生和授权方

### 撤销机制

#### 撤销权限

- **学生撤销**: 学生可以撤销任何人的访问权限
- **授权方撤销**: 授权方可以主动撤销自己的权限
- **管理员撤销**: 管理员可以撤销违规权限

#### 撤销流程

1. **发起撤销**: 学生或授权方发起撤销请求
2. **确认撤销**: 系统确认撤销操作
3. **立即生效**: 撤销后立即停止数据访问
4. **通知相关方**: 通知所有相关方

### 审计机制

#### 审计范围

- **数据查看**: 记录所有数据查看操作
- **数据导出**: 记录所有数据导出操作
- **权限变更**: 记录所有权限授予、修改、撤销操作
- **安全事件**: 记录所有安全相关事件

#### 审计字段

```typescript
interface AuditLogEntry {
  actorId: string; // 操作者ID
  action: string; // 操作类型
  targetType: string; // 目标类型
  targetId: string; // 目标ID
  metadata?: any; // 操作元数据
  ipAddress?: string; // IP地址
  userAgent?: string; // 用户代理
  severity?: 'info' | 'warning' | 'error' | 'critical';
}
```

### 搜索策略

#### 双轨机制

- **安全默认**: 学生默认不可被搜索
- **可选开放**: 学生可手动开启"可被搜索"

#### 搜索可见性选项

1. **完全私有**: 不可被搜索（默认）
2. **仅同校可见**: 只有同校的家长和老师可以搜索
3. **匿名ID可见**: 只有知道匿名ID的人可以搜索
4. **完全公开**: 平台上的所有家长和老师都可以搜索（不推荐）

#### 搜索保护措施

- **限流机制**: 搜索请求限流，防止滥用
- **匿名化处理**: 搜索结果不显示精确个人信息
- **权限验证**: 验证搜索者身份和权限
- **审计记录**: 记录所有搜索操作

## 技术实现

### 数据库设计

- **用户表**: 包含搜索可见性设置
- **关系表**: 记录学生与家长/教师的关系
- **授权表**: 记录具体的访问权限
- **同意书表**: 记录授权同意过程
- **审计日志表**: 记录所有操作日志

### API设计

- **权限验证**: 所有API都需要权限验证
- **数据过滤**: 根据权限过滤返回数据
- **审计日志**: 自动记录API调用日志
- **限流保护**: API调用限流保护

### 前端设计

- **权限提示**: 清晰显示当前权限状态
- **撤销按钮**: 便捷的权限撤销功能
- **到期提醒**: 明显的到期时间提醒
- **搜索设置**: 简单的搜索可见性设置

## 合规性要求

### 数据保护法规

- **GDPR合规**: 符合欧盟数据保护法规
- **CCPA合规**: 符合加州消费者隐私法案
- **COPPA合规**: 符合儿童在线隐私保护法案
- **本地法规**: 符合当地数据保护法规

### 隐私保护措施

- **数据最小化**: 只收集必要的数据
- **目的限制**: 数据只能用于指定目的
- **存储限制**: 数据存储时间限制
- **访问控制**: 严格的访问控制机制

### 透明度要求

- **隐私政策**: 清晰的隐私政策说明
- **数据使用**: 透明的数据使用说明
- **用户权利**: 明确的用户权利说明
- **投诉机制**: 有效的投诉处理机制

## 监控与告警

### 实时监控

- **权限使用**: 监控权限使用模式
- **异常行为**: 监控异常访问模式
- **系统性能**: 监控系统性能指标
- **安全事件**: 监控安全相关事件

### 告警机制

- **权限异常**: 检测到权限异常时发送告警
- **安全事件**: 发生安全事件时发送告警
- **系统异常**: 系统异常时发送告警
- **合规风险**: 检测到合规风险时发送告警

## 应急响应

### 安全事件响应

- **事件检测**: 快速检测安全事件
- **事件评估**: 评估事件严重程度
- **事件处理**: 快速处理安全事件
- **事件恢复**: 恢复正常服务状态

### 数据泄露响应

- **泄露检测**: 检测数据泄露事件
- **影响评估**: 评估泄露影响范围
- **通知机制**: 通知相关方泄露事件
- **补救措施**: 采取补救措施

## 持续改进

### 风险评估

- **定期评估**: 定期进行安全风险评估
- **威胁分析**: 分析新的安全威胁
- **漏洞扫描**: 定期进行漏洞扫描
- **渗透测试**: 定期进行渗透测试

### 策略更新

- **策略审查**: 定期审查安全策略
- **策略更新**: 根据新威胁更新策略
- **培训更新**: 更新安全培训内容
- **流程优化**: 优化安全流程

---

**文档版本**: v1.0  
**最后更新**: 2024-01-03  
**维护人员**: 安全团队  
**审核状态**: 待审核
