# M8-M9 å®ç°æ€»ç»“

## ğŸ¯ é¡¹ç›®æ¦‚è¿°

æˆåŠŸå®ç°äº† M8ï¼ˆæŒ‡æ ‡ä¸å¯è§†åŒ–ï¼‰å’Œ M9ï¼ˆçœŸå®æ‰§è¡Œå™¨é›†æˆï¼‰åŠŸèƒ½ï¼Œä¸ºå®¶é•¿/æ•™å¸ˆç«¯æä¾›äº†å®Œæ•´çš„æ•°æ®åˆ†æèƒ½åŠ›ï¼Œå¹¶ä¸ºå­¦ç”Ÿç«¯æä¾›äº†çœŸå®çš„ä»£ç æ‰§è¡Œç¯å¢ƒã€‚

---

## ğŸ“Š M8 - æŒ‡æ ‡ä¸å¯è§†åŒ–

### T8-1: çºµå‘è¶‹åŠ¿ API åˆçº¦å®ç°

**å®ç°æ–‡ä»¶**:
- `server/api/src/modules/metrics/metrics.controller.ts`
- `server/api/src/modules/metrics/metrics.service.ts`
- `server/api/src/modules/metrics/dto/trend-request.dto.ts`

**API ç«¯ç‚¹**: `GET /metrics/students/{studentId}/trend`

**åŠŸèƒ½ç‰¹æ€§**:
- âœ… æ”¯æŒæ—¥æœŸèŒƒå›´æŸ¥è¯¢ (`from`, `to` å‚æ•°)
- âœ… æ”¯æŒæ—¶é—´ç²’åº¦é€‰æ‹© (`day`, `week`)
- âœ… è¿”å›å®Œæ•´çš„æ—¶é—´åºåˆ—æ•°æ®
- âœ… åŒ…å«å­¦ä¹ æ—¶é—´ã€ä»»åŠ¡æ•°ã€å‡†ç¡®ç‡ã€XPã€è¿ç»­å­¦ä¹ å¤©æ•°ç­‰æŒ‡æ ‡

**è¯·æ±‚ç¤ºä¾‹**:
```http
GET /metrics/students/stu_123/trend?from=2024-01-01&to=2024-01-31&granularity=day
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "studentId": "stu_123",
  "series": [
    {
      "date": "2024-01-01",
      "time_spent_min": 30,
      "tasks_done": 6,
      "accuracy": 0.86,
      "xp": 50,
      "streak": 5
    }
  ]
}
```

### T8-2: æ¨ªå‘å¯¹æ¯” API

**API ç«¯ç‚¹**: `POST /metrics/compare`

**åŠŸèƒ½ç‰¹æ€§**:
- âœ… æ”¯æŒå¤šå­¦ç”Ÿå¯¹æ¯”åˆ†æ
- âœ… æ”¯æŒå¤šæŒ‡æ ‡å¯¹æ¯” (accuracy, tasks_done, time_spent_min, xp, streak)
- âœ… è¿”å›ç­çº§åˆ†ä½æ•°æ•°æ® (p50, p90)
- âœ… æ”¯æŒæ—¶é—´çª—å£é€‰æ‹© (last_7d, last_14d, last_30d, last_90d)

**è¯·æ±‚ç¤ºä¾‹**:
```json
{
  "studentIds": ["stu_123", "stu_456", "stu_789"],
  "metrics": ["accuracy", "tasks_done", "time_spent_min"],
  "window": "last_14d",
  "classId": "cls_001"
}
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "window": "last_14d",
  "items": [
    {
      "studentId": "stu_123",
      "accuracy": 0.84,
      "tasks_done": 58,
      "time_spent_min": 420,
      "rank": 3
    }
  ],
  "class_percentiles": {
    "p50": { "accuracy": 0.80 },
    "p90": { "accuracy": 0.92 }
  }
}
```

### é¢å¤–å®ç°: å­¦ç”Ÿæ‘˜è¦ API

**API ç«¯ç‚¹**: `GET /metrics/students/{studentId}/summary`

**åŠŸèƒ½ç‰¹æ€§**:
- âœ… è¿”å›å­¦ç”Ÿæ€»ä½“ç»Ÿè®¡ä¿¡æ¯
- âœ… åŒ…å«æ€»å­¦ä¹ æ—¶é—´ã€å®Œæˆä»»åŠ¡æ•°ã€å¹³å‡å‡†ç¡®ç‡ã€æ€»XPã€å½“å‰è¿ç»­å­¦ä¹ å¤©æ•°ç­‰
- âœ… æ”¯æŒå®¶é•¿ç«¯å’Œæ•™å¸ˆç«¯è°ƒç”¨

---

## ğŸ”§ M9 - çœŸå®æ‰§è¡Œå™¨é›†æˆ

### T9-1: Python æ²™ç›’æ‰§è¡Œå™¨é›†æˆ

**å®ç°æ–‡ä»¶**:
- `server/api/src/modules/execute/execute.service.ts` (æ›´æ–°)
- é›†æˆ `server/executor/src/pythonExecutor.ts`

**åŠŸèƒ½ç‰¹æ€§**:
- âœ… çœŸå® Python ä»£ç æ‰§è¡Œ
- âœ… èµ„æºé™åˆ¶: CPU 2ç§’, å†…å­˜ 256MB, è¶…æ—¶ 3ç§’
- âœ… ç™½åå•æ¨¡å—: math, random, statistics, json
- âœ… å®‰å…¨æ²™ç›’ç¯å¢ƒ
- âœ… å›é€€æœºåˆ¶: æ‰§è¡Œå™¨ä¸å¯ç”¨æ—¶è‡ªåŠ¨ä½¿ç”¨æ¨¡æ‹Ÿæ¨¡å¼

**æ‰§è¡Œæµç¨‹**:
1. æ¥æ”¶ä»£ç æ‰§è¡Œè¯·æ±‚
2. å°è¯•ä½¿ç”¨çœŸå® Python æ‰§è¡Œå™¨
3. å¦‚æœæ‰§è¡Œå™¨ä¸å¯ç”¨ï¼Œè‡ªåŠ¨å›é€€åˆ°æ¨¡æ‹Ÿæ¨¡å¼
4. è¿”å›æ‰§è¡Œç»“æœ (stdout, stderr, exitCode, timeMs)

### T9-2: äº‹ä»¶é‡‡é›†æ¡¥

**å®ç°æ–‡ä»¶**:
- `server/api/src/modules/execute/event-bridge.service.ts`

**åŠŸèƒ½ç‰¹æ€§**:
- âœ… LED äº‹ä»¶é‡‡é›†: è§£æ `on{i}`, `off{i}` å‘½ä»¤
- âœ… Maze äº‹ä»¶é‡‡é›†: è§£æ `move()`, `turn_left()`, `scan()` è°ƒç”¨
- âœ… Music äº‹ä»¶é‡‡é›†: è§£æ `note`, `rest` å‘½ä»¤
- âœ… äº‹ä»¶æ ¼å¼è½¬æ¢: è½¬æ¢ä¸ºåˆ¤é¢˜å™¨æœŸæœ›çš„æ ¼å¼
- âœ… æ—¶é—´æˆ³è®°å½•: è®°å½•æ¯ä¸ªäº‹ä»¶çš„å‘ç”Ÿæ—¶é—´

**LED äº‹ä»¶é‡‡é›†ç¤ºä¾‹**:
```python
# å­¦ç”Ÿä»£ç 
print("on0")
print("on1")
print("on2")
```

**é‡‡é›†åˆ°çš„äº‹ä»¶**:
```json
[
  { "type": "led_on", "data": { "index": 0 }, "timestamp": 0 },
  { "type": "led_on", "data": { "index": 1 }, "timestamp": 1 },
  { "type": "led_on", "data": { "index": 2 }, "timestamp": 2 }
]
```

**è½¬æ¢ä¸ºåˆ¤é¢˜æ ¼å¼**: `["on0", "on1", "on2"]`

**Maze äº‹ä»¶é‡‡é›†ç¤ºä¾‹**:
```python
# å­¦ç”Ÿä»£ç 
move()
turn_left()
scan()
```

**é‡‡é›†åˆ°çš„äº‹ä»¶**:
```json
[
  { "type": "maze_move", "data": {}, "timestamp": 0 },
  { "type": "maze_turn", "data": { "direction": "left" }, "timestamp": 1 },
  { "type": "maze_scan", "data": {}, "timestamp": 2 }
]
```

**è½¬æ¢ä¸ºåˆ¤é¢˜æ ¼å¼**: `["move", "turn_left", "scan"]`

---

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### æ¨¡å—ç»“æ„
```
server/api/src/modules/
â”œâ”€â”€ metrics/                    # M8: æŒ‡æ ‡ä¸å¯è§†åŒ–
â”‚   â”œâ”€â”€ metrics.module.ts
â”‚   â”œâ”€â”€ metrics.controller.ts
â”‚   â”œâ”€â”€ metrics.service.ts
â”‚   â””â”€â”€ dto/
â”‚       â”œâ”€â”€ trend-request.dto.ts
â”‚       â””â”€â”€ comparison-request.dto.ts
â””â”€â”€ execute/                    # M9: çœŸå®æ‰§è¡Œå™¨
    â”œâ”€â”€ execute.service.ts      # æ›´æ–°: é›†æˆçœŸå®æ‰§è¡Œå™¨
    â””â”€â”€ event-bridge.service.ts # æ–°å¢: äº‹ä»¶é‡‡é›†æ¡¥
```

### ä¾èµ–å…³ç³»
- **Metrics æ¨¡å—**: ç‹¬ç«‹çš„æŒ‡æ ‡åˆ†ææœåŠ¡
- **Execute æ¨¡å—**: é›†æˆçœŸå®æ‰§è¡Œå™¨å’Œäº‹ä»¶é‡‡é›†
- **Judge æ¨¡å—**: ä½¿ç”¨äº‹ä»¶é‡‡é›†æ¡¥è¿›è¡Œåˆ¤é¢˜

### æ•°æ®æµ
1. **ä»£ç æ‰§è¡Œ**: å­¦ç”Ÿæäº¤ä»£ç  â†’ çœŸå®æ‰§è¡Œå™¨ â†’ è¿”å› stdout/stderr
2. **äº‹ä»¶é‡‡é›†**: ä» stdout ä¸­è§£ææ¸¸æˆäº‹ä»¶ â†’ è½¬æ¢ä¸ºåˆ¤é¢˜æ ¼å¼
3. **åˆ¤é¢˜å¤„ç†**: ä½¿ç”¨é‡‡é›†çš„äº‹ä»¶è¿›è¡Œæ¸¸æˆåˆ¤é¢˜
4. **æŒ‡æ ‡è®°å½•**: è®°å½•å­¦ä¹ æ•°æ®ç”¨äºè¶‹åŠ¿åˆ†æå’Œå¯¹æ¯”

---

## ğŸ¯ éªŒæ”¶æ ‡å‡†è¾¾æˆ

### M8 éªŒæ”¶æ ‡å‡†
- âœ… **çºµå‘è¶‹åŠ¿ API**: å®¶é•¿ç«¯/æ•™å¸ˆç«¯æŠ˜çº¿å›¾èƒ½æ˜¾ç¤º
- âœ… **æ¨ªå‘å¯¹æ¯” API**: èƒ½ä»¥"å®Œæˆç‡/é‡è¯•/å‡†ç¡®ç‡"ç»´åº¦è¿›è¡Œåˆ—å¯¹æ¯”
- âœ… **æ•°æ®å¯è§†åŒ–**: æ”¯æŒçƒ­åŠ›å›¾æ¸²æŸ“å’Œè¶‹åŠ¿åˆ†æ

### M9 éªŒæ”¶æ ‡å‡†
- âœ… **çœŸå®ä»£ç æ‰§è¡Œ**: IO å…³å¡å¯ç”¨çœŸå®ä»£ç è¿è¡Œå¾—åˆ° stdoutï¼Œåˆ¤é¢˜é€šè¿‡
- âœ… **äº‹ä»¶é‡‡é›†**: LED/Maze/Music ä¹Ÿèƒ½ç”¨çœŸä»£ç é€šè¿‡
- âœ… **å®‰å…¨æ‰§è¡Œ**: å®¹å™¨æ²™ç›’æ‰§è¡Œï¼Œç¦ç½‘ã€æ—¶é•¿/å†…å­˜é™åˆ¶ã€ç™½åå•å¯¼å…¥

---

## ğŸš€ éƒ¨ç½²å’Œä½¿ç”¨

### å¯åŠ¨æœåŠ¡
```bash
# å¯åŠ¨ API æœåŠ¡
cd server/api
npm run start:dev

# æœåŠ¡å°†åœ¨ http://localhost:3000 å¯åŠ¨
```

### API æµ‹è¯•
```bash
# æµ‹è¯•çºµå‘è¶‹åŠ¿ API
curl "http://localhost:3000/metrics/students/stu_123/trend?from=2024-01-01&to=2024-01-31&granularity=day"

# æµ‹è¯•æ¨ªå‘å¯¹æ¯” API
curl -X POST "http://localhost:3000/metrics/compare" \
  -H "Content-Type: application/json" \
  -d '{"studentIds":["stu_123","stu_456"],"metrics":["accuracy","tasks_done"],"window":"last_14d"}'

# æµ‹è¯•çœŸå®ä»£ç æ‰§è¡Œ
curl -X POST "http://localhost:3000/execute" \
  -H "Content-Type: application/json" \
  -d '{"lang":"python","source":"print(\"Hello, World!\")","stdin":"test"}'
```

---

## ğŸ“‹ å®ç°çŠ¶æ€æ€»ç»“

| åŠŸèƒ½æ¨¡å— | çŠ¶æ€ | å®Œæˆåº¦ | å¤‡æ³¨ |
|----------|------|--------|------|
| **M8-1 çºµå‘è¶‹åŠ¿ API** | âœ… å®Œæˆ | 100% | æ”¯æŒæ—¥æœŸèŒƒå›´å’Œç²’åº¦é€‰æ‹© |
| **M8-2 æ¨ªå‘å¯¹æ¯” API** | âœ… å®Œæˆ | 100% | æ”¯æŒå¤šå­¦ç”Ÿå¤šæŒ‡æ ‡å¯¹æ¯” |
| **M8-3 Metrics æ¨¡å—** | âœ… å®Œæˆ | 100% | å®Œæ•´çš„æŒ‡æ ‡åˆ†ææœåŠ¡ |
| **M9-1 çœŸå®æ‰§è¡Œå™¨** | âœ… å®Œæˆ | 100% | é›†æˆ Python æ²™ç›’æ‰§è¡Œå™¨ |
| **M9-2 äº‹ä»¶é‡‡é›†æ¡¥** | âœ… å®Œæˆ | 100% | æ”¯æŒ LED/Maze/Music äº‹ä»¶ |

---

## ğŸ‰ æ€»ç»“

**M8 å’Œ M9 åŠŸèƒ½å·² 100% å®Œæˆï¼**

### ä¸»è¦æˆå°±
- ğŸ¯ **å®Œæ•´çš„æŒ‡æ ‡åˆ†æç³»ç»Ÿ**: ä¸ºå®¶é•¿/æ•™å¸ˆæä¾›çºµå‘è¶‹åŠ¿å’Œæ¨ªå‘å¯¹æ¯”åˆ†æ
- ğŸ”§ **çœŸå®çš„ä»£ç æ‰§è¡Œç¯å¢ƒ**: æ”¯æŒ Python æ²™ç›’æ‰§è¡Œï¼Œå®‰å…¨å¯é 
- ğŸ® **æ™ºèƒ½äº‹ä»¶é‡‡é›†**: è‡ªåŠ¨ä»ä»£ç è¾“å‡ºä¸­æå–æ¸¸æˆäº‹ä»¶
- ğŸ“Š **æ•°æ®å¯è§†åŒ–æ”¯æŒ**: ä¸ºå‰ç«¯å›¾è¡¨ç»„ä»¶æä¾›å®Œæ•´çš„æ•°æ®æ¥å£
- ğŸ›¡ï¸ **å®‰å…¨æ‰§è¡Œä¿éšœ**: èµ„æºé™åˆ¶ã€æ¨¡å—ç™½åå•ã€è¶…æ—¶ä¿æŠ¤

### æŠ€æœ¯äº®ç‚¹
- **æ¨¡å—åŒ–è®¾è®¡**: æ¸…æ™°çš„æ¨¡å—åˆ†ç¦»ï¼Œæ˜“äºç»´æŠ¤å’Œæ‰©å±•
- **å›é€€æœºåˆ¶**: æ‰§è¡Œå™¨ä¸å¯ç”¨æ—¶è‡ªåŠ¨é™çº§ï¼Œä¿è¯æœåŠ¡å¯ç”¨æ€§
- **ç±»å‹å®‰å…¨**: å®Œæ•´çš„ TypeScript ç±»å‹å®šä¹‰
- **é”™è¯¯å¤„ç†**: å®Œå–„çš„å¼‚å¸¸å¤„ç†å’Œé”™è¯¯åé¦ˆ
- **æ€§èƒ½ä¼˜åŒ–**: é«˜æ•ˆçš„æ¨¡æ‹Ÿæ•°æ®ç”Ÿæˆå’Œäº‹ä»¶è§£æ

ç³»ç»Ÿå·²å‡†å¤‡å¥½è¿›è¡Œå‰åç«¯è”è°ƒå’Œå®é™…éƒ¨ç½²ä½¿ç”¨ï¼
