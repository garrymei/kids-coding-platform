# 下一步开发建议（关卡答案与判题逻辑整改后）

本次整改完成了两类核心问题：其一是替换会在默认代码区直接泄露参考答案的关卡内容，并为官方答案生成哈希签名；其二是修复像素、音乐、灯阵等玩法在未编写/错误代码情况下依旧显示通过的判题漏洞。下面是基于当前仓库状态整理出的后续落地任务清单：

## 急需完善的方向

1. **前端判题仅做占位校验，需要接入真实执行器**  
   目前 `runAndJudge` 中针对非 I/O 玩法的校验是通过参考答案哈希对比实现的，只能阻止明显错误，并不能接受多样化的正确解。下一步需接入后端统一判题服务，或在前端引入沙箱解释器（如 Pyodide）以按测试用例真实执行学生代码。

2. **参考答案交付应改为按需获取并带权限校验**  
   本次虽用提示语替换了 `solution` 字段的明文答案，并新增哈希签名，但关卡 JSON 仍在前端静态资源中暴露校验信息。建议把参考答案迁移到受控的 API（已存在 `/reference` 接口雏形），并在后端增加身份/频率校验，同时记录查看日志。

3. **扩充自动化验收脚本**  
   `validate_reference_solutions.py` 能验证官方答案的正确性，但尚未覆盖“starter 是否包含答案”“判题是否会在空代码时通过”等风险点。建议新增脚本：

- 扫描所有 starter/提示，确保不含参考答案关键片段。
- 对每类玩法使用错误代码调用前端判题逻辑，确认均判定为失败。
- 校验哈希签名与后端参考答案保持一致，避免签名失效导致误判。

4. **完善 UI 引导与提示体系**  
   替换后的 starter 目前以文字提示为主，可结合玩法提供更具操作性的骨架代码（如函数签名、循环框架），同时在界面上增加“查看提示/技巧”模块，避免学生因为缺乏起始方向而迷茫。

5. **统一关卡数据来源与版本管理**  
   当前关卡定义分散在 `public/levels` 与 `server/api/src/data` 两处。后续可考虑改为单一数据源（数据库或仓库子模块），并提供打包脚本，避免手动同步导致的错漏。

## 建议配套工作

- 为学生端新增 E2E 测试，覆盖“未输入代码 → 判题失败”“错误代码 → 提示信息” 等关键路径。
- 在教师/运营后台加入关卡配置校验页，自动检测 starter、测试用例与参考答案的一致性。
- 按玩法梳理更精细的提示体系，例如像素关卡提供图案缩略预览、音乐关卡提供节拍可视化参考。

上述清单可作为下一轮迭代的工作分解依据，优先完成执行器与权限部分，可显著提升平台的教学公平性与内容安全性。
